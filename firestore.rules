rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    function isAuthenticated() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    // --- CHEF-TO-CART RULES (Shared Family Mode) ---
    
    // Recipes Collection
    match /recipes/{recipeId} {
      allow read, write: if isAuthenticated();
    }
    
    // Meal Plans Collection
    match /meal_plans/{planId} {
      allow read, write: if isAuthenticated();
    }
    
    // Pantry Collection
    match /pantry/{pantryId} {
      allow read, write: if isAuthenticated();
    }

    // --- YOUR EXISTING RULES (Preserved) ---
    match /settings/{userId} { allow read, write: if isOwner(userId); }
    match /transactions/{docId} { allow read, write: if isAuthenticated(); }
    match /xero_transactions/{docId} { allow read, write: if isAuthenticated(); }
    match /annual_reports/{year} { allow read, write: if isAuthenticated(); }
    match /doors/{doorId} { allow read, update, delete: if isAuthenticated(); allow create: if isAuthenticated() && request.resource.data.uid == request.auth.uid; }
    match /dossier_requests/{requestId} { allow create: if true; allow read, update, delete: if isAuthenticated(); }
    match /project_dashboard/{docId} { allow read, write: if isAuthenticated(); }
    match /indexer_analysis/{docId} { allow read, write: if isAuthenticated(); }
    match /artifacts/{appId}/{document=**} { allow read, write: if isAuthenticated(); }
    match /site_visits/{document=**} { allow create: if true; allow read: if request.auth != null; }
    match /planning_sections/{document=**} { allow read, write: if true; }
    match /planning_zones/{document=**} { allow read, write: if true; }
    match /xero_accounts/{docId} { allow read, write: if isAuthenticated(); }
    match /xero_invoices/{docId} { allow read, write: if isAuthenticated(); }
    match /xero_bank_statement_lines/{docId} { allow read, write: if isAuthenticated(); }
    match /xero_custom_report/{docId} { allow read, write: if request.auth != null; }
    match /lift_monitor/{docId} { allow read, write: if isAuthenticated(); }
    match /helvar_devices/{device} { allow read: if request.auth != null; allow write: if false; }
    match /helvar_commands/{commandId} { allow create, read, delete: if true; }
    match /lift_history/{docId} { allow read, write: if request.auth != null; }
    match /lift_prediction/{document=**} { allow read: if true; allow write: if false; }
    match /door_audio_events/{document} { allow read: if request.auth != null; }
    match /settings/eufy_viewer { allow read, write: if request.auth != null; }
    match /site_logs/{docId} { allow read, write: if request.auth != null; }
    match /drawing_projects/{projectId} { allow read, write: if isAuthenticated(); }
    match /timesheets/{docId} { allow read, write: if request.auth != null; }
  }
}
